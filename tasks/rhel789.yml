- name: First, try regular updates with Satellite or CDN
  block:
    # No need to check for installed versions, this task also does that
    - name: Check if package is at the right version already or try regular update
      ansible.builtin.package:
        name: tzdata>=2022g
        state: present
  # If unsuccessful, try putting the updated packages manually
  rescue:
    - name: Download tzdata package(s)
      ansible.builtin.get_url:
        url: "{{ package_repository }}/{{ item }}"
        dest: ./
      delegate_to: localhost
      loop: "{{ tz_packages[ansible_distribution_major_version] }}"
    
    - name: Push the static packages to the managed node
      ansible.builtin.copy:
        src: ./{{ item }}
        dest: .
      loop: "{{ tz_packages[ansible_distribution_major_version] }}"

    - name: Install the actual packages
      ansible.builtin.package:
        name: ./{{ item }}
        state: present
      loop: "{{ tz_packages[ansible_distribution_major_version] }}"
